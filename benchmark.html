<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOD Loader Benchmark</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #1e1e1e; color: #d4d4d4; padding: 20px; }
        h1 { color: #569cd6; }
        button { background: #0e639c; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #1177bb; }
        button:disabled { background: #555; cursor: not-allowed; }
        #results { background: #252526; border: 1px solid #333; padding: 15px; margin-top: 20px; white-space: pre-wrap; font-family: "Consolas", monospace; font-size: 14px; }
    </style>
</head>
<body>
    <h1>LOD Loader Benchmark</h1>
    <p>Open the browser console for more details. Click a button to run a test.</p>
    
    <button id="run-all">Run All Tests</button>
    <button id="clear-log">Clear Log</button>
    
    <hr>
    
    <button id="test1">1. Your Library (Dynamic Generation)</button>
    <button id="test2">2. Your Library (Pre-processed)</button>
    <button id="test3">3. Three.js (High-Poly Only)</button>
    <button id="test4">4. Three.js (Manual LOD Setup)</button>

    <h2>Results:</h2>
    <pre id="results"></pre>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    
    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        
        // IMPORTANT: Adjust this path to your library's loader file
        import { loadGLTF } from './library/core/loader.js';

        const resultsLog = document.getElementById('results');
        const buttons = document.querySelectorAll('button');

        // --- Helper Functions ---
        const log = (message) => {
            console.log(message);
            resultsLog.textContent += message + '\n';
        };
        
        const disableButtons = (disabled) => buttons.forEach(b => b.disabled = disabled);

        // --- Test Definitions ---

        /**
         * TEST 1: Your library's on-the-fly LOD generation.
         */
        async function runTest1() {
            log('🚀 Starting Test 1: Your Library (Dynamic Generation)...');
            const startTime = performance.now();
            
            try {
                await loadGLTF('./public/ship.glb', {
                    lod: true,
                    mode: 'development' // Assumes you have a 'development' mode for dynamic generation
                });
                const duration = performance.now() - startTime;
                log(`✅ Test 1 Complete: Dynamic generation took ${duration.toFixed(2)} ms.`);
            } catch (error) {
                log(`❌ Test 1 Failed: ${error}`);
            }
        }
        
        /**
         * TEST 2: Your library loading pre-processed files.
         */
        async function runTest2() {
            log('🚀 Starting Test 2: Your Library (Pre-processed)...');
            log('   (Requires ship.glb, ship_lod1.glb, ship_lod2.glb in /public)');
            const startTime = performance.now();
            
            try {
                await loadGLTF('./public/ship.glb', {
                    lod: true,
                    mode: 'production' // Assumes you have a 'production' mode
                });
                const duration = performance.now() - startTime;
                log(`✅ Test 2 Complete: Loading pre-processed LODs took ${duration.toFixed(2)} ms.`);
            } catch (error) {
                log(`❌ Test 2 Failed: ${error}`);
            }
        }

        /**
         * TEST 3: Standard Three.js loading only the high-poly model.
         */
        async function runTest3() {
            log('🚀 Starting Test 3: Three.js (High-Poly Only)...');
            const startTime = performance.now();
            
            try {
                const loader = new GLTFLoader();
                await loader.loadAsync('./public/ship.glb');
                const duration = performance.now() - startTime;
                log(`✅ Test 3 Complete: Loading high-poly model took ${duration.toFixed(2)} ms.`);
            } catch (error) {
                log(`❌ Test 3 Failed: ${error}`);
            }
        }

        /**
         * TEST 4: Standard Three.js manually setting up LODs with pre-processed files.
         */
        async function runTest4() {
            log('🚀 Starting Test 4: Three.js (Manual LOD Setup)...');
            log('   (Requires ship.glb, ship_lod1.glb, ship_lod2.glb in /public)');
            const startTime = performance.now();
            
            try {
                const loader = new GLTFLoader();
                const [high, medium, low] = await Promise.all([
                    loader.loadAsync('./public/ship.glb'),
                    loader.loadAsync('./public/ship_lod1.glb'),
                    loader.loadAsync('./public/ship_lod2.glb')
                ]);

                const lodObject = new THREE.LOD();
                lodObject.addLevel(high.scene, 0);
                lodObject.addLevel(medium.scene, 20);
                lodObject.addLevel(low.scene, 50);

                const duration = performance.now() - startTime;
                log(`✅ Test 4 Complete: Manual LOD setup took ${duration.toFixed(2)} ms.`);
            } catch (error) {
                log(`❌ Test 4 Failed: ${error}`);
            }
        }

        // --- Event Listeners ---
        document.getElementById('test1').addEventListener('click', async () => {
            disableButtons(true);
            await runTest1();
            disableButtons(false);
        });
        document.getElementById('test2').addEventListener('click', async () => {
            disableButtons(true);
            await runTest2();
            disableButtons(false);
        });
        document.getElementById('test3').addEventListener('click', async () => {
            disableButtons(true);
            await runTest3();
            disableButtons(false);
        });
        document.getElementById('test4').addEventListener('click', async () => {
            disableButtons(true);
            await runTest4();
            disableButtons(false);
        });
        
        document.getElementById('run-all').addEventListener('click', async () => {
            disableButtons(true);
            resultsLog.textContent = ''; // Clear previous results
            await runTest1();
            await runTest2();
            await runTest3();
            await runTest4();
            log('\nAll tests complete.');
            disableButtons(false);
        });

        document.getElementById('clear-log').addEventListener('click', () => {
            resultsLog.textContent = '';
        });
    </script>
</body>
</html>